friendly_name: Mozilla VPN Subscriptions
description: |
  A mirror of the subscriptions table from the Mozilla VPN (Guardian) CloudSQL database, updated daily to match the current state of the table. The table history is not needed, because changes made are not destructive, except in the case of self-serve data deletion.
owners:
- srose@mozilla.com
labels:
  application: mozilla_vpn
  schedule: daily
  dag: bqetl_subplat
  owner1: srose
scheduling:
  dag_name: bqetl_subplat
  date_partition_parameter: null
  depends_on_past: true
  parameters:
  - "external_database_query:STRING: SELECT\n  id,\n  user_id,\n  is_active,\n  mullvad_token,\n\
    \  mullvad_account_created_at,\n  mullvad_account_expiration_date,\n  ended_at,\n\
    \  created_at,\n  updated_at,\n  type,\n  fxa_last_changed_at,\n  fxa_migration_note\n\
    FROM subscriptions WHERE DATE(updated_at) = DATE '{{ds}}'"
  referenced_tables: []
bigquery:
  time_partitioning:
    type: day
    field: updated_at
    require_partition_filter: false
    expiration_days: null
  clustering: null
workgroup_access:
- role: roles/bigquery.dataEditor
  members:
  - workgroup:platform-infra/internal
references:
  init.sql:
  - EXTERNAL_QUERY('moz-fx-guardian-prod-bfc7.us.guardian-sql-prod', '\n    SELECT\n      id,\n      user_id,\n      is_active,\n      mullvad_token,\n      mullvad_account_created_at,\n      mullvad_account_expiration_date,\n      ended_at,\n      created_at,\n      updated_at,\n      type,\n      fxa_last_changed_at,\n      fxa_migration_note\n    FROM
    subscriptions\n    ')
  query.sql:
  - EXTERNAL_QUERY('moz-fx-guardian-prod-bfc7.us.guardian-sql-prod', @external_database_query)
  - subscriptions_v1
deprecated: false
